name: Cypress tests
on: [push]
jobs:
  cypress-run:
    name: Cypress run
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Npm install
        run: npm install
          # Cypress
      - name: Cypress verify
        run: npx cypress verify
      - name: Find google-chrome
        run: which google-chrome || true
      - uses: cypress-io/github-action@v2
        id: cypress
        continue-on-error: true
        with:
          start: php artisan serve
          browser: google-crome
          headless: true
          record: true
          parallel: true
          install: true
#           group: github action ${{ matrix.browser }}
#           tag: ${{ github.event_name }}
          config: baseUrl=http://localhost:8000
          wait-on: http://localhost:8000
        env:
          CYPRESS_RECORD_KEY: a3507380-0c6e-4817-9b9d-04fa9e413e95
          GITHUB_TOKEN: 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
          COMMIT_INFO_MESSAGE: 'cypress test'
#       - name: Composer update 
#         run: composer install
#         #run: npx cypress cache path
#       - name: Clear cypress cache 
#         run: rm -rf /home/runner/.cache/Cypress
#       - name : Cypres Install
#         run:  npx cypress install
#       - name: brooowser update
#         run: npx browserslist@latest --update-db
#       - name: Composer 
#         run: composer require laracasts/cypress --dev
#       - name: Clear cache
#         run:  php artisan optimize
#       - name: cypress:boilerplate
#         run: php artisan cypress:boilerplate
#       - name: PHP Start
#         run: php artisan serve &
#       # run: nohup php artisan serve &
# #       - name: Export key
# #         run: export CYPRESS_RECORD_KEY=a3507380-0c6e-4817-9b9d-04fa9e413e95
#       - name: cypress run
# #         run:  npx cypress run --record --key a3507380-0c6e-4817-9b9d-04fa9e413e95
#         run: ./node_modules/.bin/cypress run

